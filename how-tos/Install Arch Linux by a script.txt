• Example

Arch Linux KDE UKI, https://wiki.archlinux.org/title/Unified_kernel_image#Booting .

/dev/sdb is the installer drive (e.g. an USB drive)
/dev/sdb1 is the partition containing the installer Bash script named e.g. 0
/dev/sdb2 is the FAT32 (the default file system bootable by BIOS UEFI) partition containing Arch Linux Netboot or the pasted content of archlinux-x86_64.iso .

The -c option of pacstrap https://man.archlinux.org/man/pacstrap.8 is used, RAM is faster & to avoid fragmentation on the OS partition.

The target PC is a Lenovo ideacentre https://pcsupport.lenovo.com/us/en/products/desktops-and-all-in-ones/300-series/aio-310-20asr/f0ck , only 4 GiB of RAM, so 0 needs tweaks to use the swap partition at installation (e.g. 32 GiB of RAM: no need).

Boot /dev/sdb2

• Pre installation

⃝
bash    # because Arch Linux uses Bash by default, so why Zsh in the installer? https://bbs.archlinux.org/viewtopic.php?id=302631
localectl set-keymap fr    # azerty (I'm french)
ls -l /dev/disk/by-id    # get the ID of the target PC drive (e.g. ata-WDC_WD10JPVX-08JC3T6_WD-WXU1AA6PDZNT ) to write in 0
mount /dev/sdb1 /home    # /home is empty
/home/a_path/0|tee .txt    # |tee .txt is an option, to log the 0 message
⏺

• Installation

/dev/disk/by-id/ata-WDC_WD10JPVX-08JC3T6_WD-WXU1AA6PDZNT is the target PC drive
/dev/disk/by-id/ata-WDC_WD10JPVX-08JC3T6_WD-WXU1AA6PDZNT-part1 is the ESP
/dev/disk/by-id/ata-WDC_WD10JPVX-08JC3T6_WD-WXU1AA6PDZNT-part2 is the OS partition
/dev/disk/by-id/ata-WDC_WD10JPVX-08JC3T6_WD-WXU1AA6PDZNT-part3 is the swap partition
/dev/disk/by-id/ata-WDC_WD10JPVX-08JC3T6_WD-WXU1AA6PDZNT-part4 is the data partition

0 contains:

⃝
mount -o remount,size=0 /tmp    # tweak, remove the limit of tmpfs, https://man.archlinux.org/man/tmpfs.5 , https://wiki.archlinux.org/title/Tmpfs
sed -i '/Ca/cCacheDir=/tmp/!    # use the RAM
/Ch/d' /etc/pacman.conf    # tweak, use the swap partition, Ch : CheckSpace
fdisk /dev/disk/by-id/ata-WDC_WD10JPVX-08JC3T6_WD-WXU1AA6PDZNT<<<'n


133119
n


943208151
n

943208152
976762583
n

976762584
1953525134
w'    # partitioning
sleep 3    # otherwise the formatting under fails, 2 fails
mkfs.fat /dev/disk/by-id/ata-WDC_WD10JPVX-08JC3T6_WD-WXU1AA6PDZNT-part1
mkfs.ext4 /dev/disk/by-id/ata-WDC_WD10JPVX-08JC3T6_WD-WXU1AA6PDZNT-part2
mkswap /dev/disk/by-id/ata-WDC_WD10JPVX-08JC3T6_WD-WXU1AA6PDZNT-part3
mkfs.ext4 /dev/disk/by-id/ata-WDC_WD10JPVX-08JC3T6_WD-WXU1AA6PDZNT-part4    # formatting
mount /dev/disk/by-id/ata-WDC_WD10JPVX-08JC3T6_WD-WXU1AA6PDZNT-part2 /mnt
chmod 777 /mnt    # enable read, write & execute
mount --mkdir /dev/disk/by-id/ata-WDC_WD10JPVX-08JC3T6_WD-WXU1AA6PDZNT-part1 /mnt/efi
mkdir /mnt/efi/efi
mkdir /mnt/efi/efi/boot
mkdir /mnt/etc
mkdir /mnt/etc/mkinitcpio.d
echo -en ALL_kver='$(ls /usr/lib/modules)\'nPRESETS='\'n_uki=/efi/efi/boot/bootx64.efi>/mnt/etc/mkinitcpio.d/linux.preset
mkdir /mnt/etc/kernel
echo *n root=/dev/disk/by-id/ata-WDC_WD10JPVX-08JC3T6_WD-WXU1AA6PDZNT-part2 resume=/dev/disk/by-id/ata-WDC_WD10JPVX-08JC3T6_WD-WXU1AA6PDZNT-part3 rw>/mnt/etc/kernel/cmdline    # prepare & tell mkinitcpio to create an UKI
swapon /dev/disk/by-id/ata-WDC_WD10JPVX-08JC3T6_WD-WXU1AA6PDZNT-part3    # tweak, enable the swap partition
pacstrap -cMK /mnt base linux dosfstools f2fs-tools man-db nano sudo linux-firmware-amdgpu linux-firmware-atheros plasma-meta pipewire-jack kde-applications-meta dvd+rw-tools chromium vlc vlc-plugins-all cmatrix supertuxkart teeworlds    # need to precise pipewire-jack because otherwise jack2 by default instead, https://bbs.archlinux.org/viewtopic.php?id=311984
rm -r /tmp/!    # remove the downloaded packages
arch-chroot /mnt bash -c "pacman -Qqd|pacman -Rsun --noconfirm -    # clean, https://wiki.archlinux.org/title/Pacman/Tips_and_tricks#Removing_unused_packages_.28orphans.29
systemctl enable NetworkManager sddm
ln -s /usr/share/zoneinfo/UTC /etc/localtime
hwclock -w
echo -en /dev/disk/by-id/ata-WDC_WD10JPVX-08JC3T6_WD-WXU1AA6PDZNT-part1 /efi auto'\'n/dev/disk/by-id/ata-WDC_WD10JPVX-08JC3T6_WD-WXU1AA6PDZNT-part3 none swap>/etc/fstab
sed -i 15,17d /usr/lib/tmpfiles.d/var.conf
rm /var/log/wtmp /var/log/btmp /var/log/lastlog    # option, https://gitlab.archlinux.org/archlinux/packaging/packages/systemd/-/issues/66
useradd -m a    # config, add the user named a
sed -i '1s/x//
\$s/x//' /etc/passwd    # config, remove the root & user passwords
sed -i '/t A/s/^/# /
/L A/s/^..//' /etc/sudoers   # option (strongly recommended) enable sudo
sed -i /W/,/^$/{//!s/.//} /etc/pacman.d/mirrorlist    # config, only the Worldwide mirrors
sed -i '/Ca/cCacheDir=/tmp/!    # option, use the RAM (& maybe the swap partition, can happen with only 4 GiB of RAM...)
/b]/,+1s/.//' /etc/pacman.conf    # option, enable the multilib repo, e.g. Steam https://archlinux.org/packages/multilib/x86_64/steam/ is still 32-bit...
echo -n unset HISTFILE>>/etc/bash.bashrc"    # option, not log the Bash commands in /home/a/.bash_history
umount /mnt/efi
umount /mnt
mount /dev/disk/by-id/ata-WDC_WD10JPVX-08JC3T6_WD-WXU1AA6PDZNT-part4 /mnt
chmod 777 /mnt
cp .txt /home/a_path    # copy paste the installation log to the non volatile memory /dev/sdb
⏺

• Post installation

Konsole
⃝
sed -i /rt/s/true/false/ /home/a/.config/akonadi/akonadiserverrc    # option, https://discuss.kde.org/t/why-akonadi-uses-ram-despite-not-used/43327
>/home/a/.local/share/recently-used.xbel
chmod u=r /home/a/.local/share/recently-used.xbel    # option, https://askubuntu.com/questions/269858/how-do-i-prevent-the-file-recently-used-xbel-from-being-created
localectl set-keymap fr
⏺
Reboot, to localectl set-keymap fr takes effect.